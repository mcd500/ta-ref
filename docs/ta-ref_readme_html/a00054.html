<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TA-REF: How to run sample TA programs on TA-Ref</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TA-REF
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('a00054.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to run sample TA programs on TA-Ref </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Currently TA-Ref supports writing TA's for three targets namely</p><ul>
<li>Keystone</li>
<li>OP-TEE</li>
<li>Intel SGX</li>
</ul>
<p >The pre-built TA-Ref Docker images for all three targets are already available. The details are mentioned below</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Target   </th><th class="markdownTableHeadNone">Docker image    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Keystone   </td><td class="markdownTableBodyNone">aistcpsec/taref-dev:keystone    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OP-TEE   </td><td class="markdownTableBodyNone">aistcpsec/taref-dev:optee    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Intel SGX   </td><td class="markdownTableBodyNone">aistcpsec/taref-dev:sgx   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md14"></a>
Run samples for Keystone</h1>
<p >Sample to be executed : <b>message_digest</b></p>
<p >Docker Image : <b>aistcpsec/taref-dev:keystone</b></p>
<p >Following are the steps to be executed to run samples for Keystone.</p>
<div class="fragment"><div class="line"># Pull the docker image</div>
<div class="line">$ docker pull aistcpsec/taref-dev:keystone</div>
<div class="line"> </div>
<div class="line">#Run the docker image</div>
<div class="line">$ docker run -it aistcpsec/taref-dev:keystone</div>
<div class="line"> </div>
<div class="line"># [Inside docker image]</div>
<div class="line"># Initally you would be logged-in as build-user.</div>
<div class="line"># If you are root user, change to build-user using # su build-user command.</div>
<div class="line"> </div>
<div class="line"># Changes to ta-ref folder</div>
<div class="line">$ cd ${TAREF_DIR}</div>
<div class="line"> </div>
<div class="line"># Move to keystone build directory</div>
<div class="line">$ cd samples/message_digest/build-keystone/</div>
<div class="line"> </div>
<div class="line"># Make the message-digest sample</div>
<div class="line">$ make</div>
<div class="line"> </div>
<div class="line"># Run the qemu console</div>
<div class="line">$ make run-qemu</div>
<div class="line"> </div>
<div class="line"># This opens us qemu console and login using</div>
<div class="line"># buildroot login: root</div>
<div class="line"># Password: sifive</div>
<div class="line"> </div>
<div class="line"># [Inside Qemu Console]</div>
<div class="line"># Execute the sample and see the output</div>
<div class="line"># Load the keystone driver</div>
<div class="line">$ insmod keystone-driver.ko</div>
<div class="line"> </div>
<div class="line"># Run the message-digest program</div>
<div class="line">$./App-keystone</div>
<div class="line"> </div>
<div class="line"># Exit the qemu console by clicking Ctrl-A X or $ poweroff command</div>
<div class="line">### Ctrl-a x</div>
</div><!-- fragment --><p >Following is the output inside qemu when you execute the sample program.</p>
<div class="fragment"><div class="line"># insmod keystone-driver.ko</div>
<div class="line">[   90.867089] keystone_driver: loading out-of-tree module taints kernel.</div>
<div class="line">[   90.877175] keystone_enclave: keystone enclave v1.0.0</div>
<div class="line">#</div>
<div class="line"># ./App-keystone</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799de000-0x179c00000 (2184 KB), va 0xffffffff001de000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line">main start</div>
<div class="line">TEE_AllocateOperation(): start</div>
<div class="line">TEE_FreeOperation(): start</div>
<div class="line">TEE_DigestDoFinal(): start</div>
<div class="line">TEE_FreeOperation(): start</div>
<div class="line">hash: 39 46 2d 2a 23 20 f8 da 57 2a 97 b0 b3 94 73 d4 31 2e 02 28 b2 3e 2c 2f e0 ae 9b 6c 67 f2 34 3c</div>
<div class="line">TEE_CreatePersistentObject(): start</div>
<div class="line">TEE_WriteObjectData(): start</div>
<div class="line">TEE_CloseObject(): start</div>
<div class="line">main end</div>
<div class="line">[debug] UTM : 0xffffffff80000000-0xffffffff80100000 (1024 KB) (boot.c:127)</div>
<div class="line">[debug] DRAM: 0x179800000-0x179c00000 (4096 KB) (boot.c:128)</div>
<div class="line">[debug] FREE: 0x1799de000-0x179c00000 (2184 KB), va 0xffffffff001de000 (boot.c:133)</div>
<div class="line">[debug] eyrie boot finished. drop to the user land ... (boot.c:172)</div>
<div class="line">main start</div>
<div class="line">TEE_AllocateOperation(): start</div>
<div class="line">TEE_FreeOperation(): start</div>
<div class="line">TEE_DigestDoFinal(): start</div>
<div class="line">TEE_FreeOperation(): start</div>
<div class="line">hash: 39 46 2d 2a 23 20 f8 da 57 2a 97 b0 b3 94 73 d4 31 2e 02 28 b2 3e 2c 2f e0 ae 9b 6c 67 f2 34 3c</div>
<div class="line">TEE_OpenPersistentObject(): start</div>
<div class="line">TEE_ReadObjectData(): start</div>
<div class="line">TEE_CloseObject(): start</div>
<div class="line">hash: matched!</div>
<div class="line">main end</div>
<div class="line">#</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md15"></a>
Run samples for OP-TEE</h1>
<p >Sample to be executed : <b>message_digest</b></p>
<p >Docker Image : <b>aistcpsec/taref-dev:optee</b></p>
<p >Following are the steps to be executed to run samples for OP-TEE.</p>
<div class="fragment"><div class="line"># Pull the docker image</div>
<div class="line">$ docker pull aistcpsec/taref-dev:optee</div>
<div class="line"> </div>
<div class="line"># Run the docker image</div>
<div class="line">$ docker run -it aistcpsec/taref-dev:optee</div>
<div class="line"> </div>
<div class="line"># [Inside docker image]</div>
<div class="line"># Initally you would be logged-in as build-user.</div>
<div class="line"># If you are root user, change to build-user using # su build-user command.</div>
<div class="line">$ cd ${TAREF_DIR}</div>
<div class="line"> </div>
<div class="line"># Move to Optee build directory</div>
<div class="line">$ cd samples/message_digest/build-optee/</div>
<div class="line"> </div>
<div class="line"># Make the message-digest sample</div>
<div class="line">$ make</div>
<div class="line"> </div>
<div class="line"># Make the qemu</div>
<div class="line">make install_qemu</div>
<div class="line"> </div>
<div class="line"># Run the qemu console</div>
<div class="line">$ make run-qemu</div>
<div class="line"> </div>
<div class="line"># This opens us qemu console and login using</div>
<div class="line"># buildroot login: root</div>
<div class="line"> </div>
<div class="line"># [Inside Qemu Console]</div>
<div class="line"># Execute the sample and see the output</div>
<div class="line"># Run the message-digest program</div>
<div class="line">./App-optee</div>
<div class="line"> </div>
<div class="line"># The output of the program is not displayed inside qemu.</div>
<div class="line"># Inside the docker, it cannot open two console, one for Linux and one for optee,</div>
<div class="line"># so saving the console output to file for optee. It is saved inside the serial.log</div>
<div class="line"> </div>
<div class="line"># Exit the qemu console by clicking Ctrl-A X or $ poweroff command</div>
<div class="line">### Ctrl-a x</div>
</div><!-- fragment --><p >To view the output, open the serial log file by executing the following command outside qemu.</p>
<div class="fragment"><div class="line">$ cat /home/user/optee/out/bin/serial1.log</div>
<div class="line"> </div>
<div class="line">hash: be 45 cb 26 05 bf 36 be bd e6 84 84 1a 28 f0 fd 43 c6 98 50 a3 dc e5 fe db a6 99 28 ee 3a 89 91</div>
<div class="line">hash: be 45 cb 26 05 bf 36 be bd e6 84 84 1a 28 f0 fd 43 c6 98 50 a3 dc e5 fe db a6 99 28 ee 3a 89 91</div>
<div class="line">hash: matched!</div>
<div class="line">D/TC:? 0 tee_ta_close_session:499 csess 0x6377e860 id 1</div>
<div class="line">D/TC:? 0 tee_ta_close_session:518 Destroy session</div>
<div class="line">#</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md16"></a>
Run samples for Intel SGX</h1>
<p >Sample to be executed : <b>message_digest</b></p>
<p >Docker Image : <b>aistcpsec/taref-dev:sgx</b></p>
<p >Following are the steps to be executed to run samples for SGX.</p>
<div class="fragment"><div class="line"># Pull the docker image</div>
<div class="line">$ docker pull aistcpsec/taref-dev:sgx</div>
<div class="line"> </div>
<div class="line"># Run the docker image</div>
<div class="line">$ docker run -it aistcpsec/taref-dev:sgx</div>
<div class="line"> </div>
<div class="line"># [Inside docker image]</div>
<div class="line"># Initally you would be logged-in as build-user.</div>
<div class="line"># If you are root user, change to build-user using # su build-user command.</div>
<div class="line">$ cd ${TAREF_DIR}</div>
<div class="line"> </div>
<div class="line"># Move to SGX build directory</div>
<div class="line">$ cd samples/message_digest/build-sgx/</div>
<div class="line"> </div>
<div class="line"># Make the message-digest sample for Simulation mode</div>
<div class="line">$ make</div>
<div class="line"> </div>
<div class="line"># This creates the App_sgx and enclave.signed.so</div>
<div class="line"># You can copy this two files alone to any places and run the App_sgx</div>
<div class="line">$ ./App_sgx</div>
</div><!-- fragment --><p >Trimmed the output in the App_sgx shown below</p>
<div class="fragment"><div class="line">.</div>
<div class="line">.</div>
<div class="line">[read_cpusvn_file ../cpusvn_util.cpp:96] Couldn&#39;t find/open the configuration file /home/user/.cpusvn.conf.</div>
<div class="line">main start</div>
<div class="line">TEE_AllocateOperation(): start</div>
<div class="line">TEE_FreeOperation(): start</div>
<div class="line">TEE_DigestDoFinal(): start</div>
<div class="line">TEE_FreeOperation(): start</div>
<div class="line">hash: 39 46 2d 2a 23 20 f8 da 57 2a 97 b0 b3 94 73 d4 31 2e 02 28 b2 3e 2c 2f e0 ae 9b 6c 67 f2 34 3c</div>
<div class="line">TEE_CreatePersistentObject(): start</div>
<div class="line">TEE_WriteObjectData(): start</div>
<div class="line">TEE_CloseObject(): start</div>
<div class="line">main end</div>
<div class="line">main start</div>
<div class="line">TEE_AllocateOperation(): start</div>
<div class="line">TEE_FreeOperation(): start</div>
<div class="line">TEE_DigestDoFinal(): start</div>
<div class="line">TEE_FreeOperation(): start</div>
<div class="line">hash: 39 46 2d 2a 23 20 f8 da 57 2a 97 b0 b3 94 73 d4 31 2e 02 28 b2 3e 2c 2f e0 ae 9b 6c 67 f2 34 3c</div>
<div class="line">TEE_OpenPersistentObject(): start</div>
<div class="line">TEE_ReadObjectData(): start</div>
<div class="line">TEE_CloseObject(): start</div>
<div class="line">hash: matched!</div>
<div class="line">main end</div>
<div class="line">Info: Enclave successfully returned.</div>
<div class="line">build-user@b9755ab0abea:~/ta-ref/samples/message_digest/build-sgx$ ^C</div>
<div class="line">build-user@b9755ab0abea:~/ta-ref/samples/message_digest/build-sgx$ exit</div>
<div class="line">exit</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
