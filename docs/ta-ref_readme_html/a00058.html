<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TA-REF: Preparation before building TA-Ref without Docker</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">TA-REF
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('a00058.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Preparation before building TA-Ref without Docker </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >All the preparation steps below are based on Ubuntu 20.04 and 22.04.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Keystone(RISC-V Unleased)</h1>
<p >Keystone is an open-source TEE framework for RISC-V processors. For more details check,</p><ul>
<li><a href="http://docs.keystone-enclave.org/en/latest">http://docs.keystone-enclave.org/en/latest</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md41"></a>
Required Packages</h2>
<p >Install the following packages for building TA-Ref on Keystone</p>
<p >For ubuntu 20.04 </p><div class="fragment"><div class="line">$ sudo apt-get update</div>
<div class="line"> </div>
<div class="line"># Following packages are required for Keystone</div>
<div class="line">$ sudo apt-get install -y autoconf automake autotools-dev bc bison \</div>
<div class="line">  build-essential curl expat libexpat1-dev flex gawk gcc git gperf libgmp-dev \</div>
<div class="line">  libmpc-dev libmpfr-dev libtool texinfo tmux patchutils zlib1g-dev wget \</div>
<div class="line">  bzip2 patch vim-common lbzip2 python pkg-config libglib2.0-dev libpixman-1-dev \</div>
<div class="line">  libssl-dev screen device-tree-compiler expect makeself unzip cpio rsync cmake \</div>
<div class="line">  p7zip-full python3-pip</div>
<div class="line"> </div>
<div class="line"># Following packages are required for clang, keyedge and make run commands in TA-Ref.</div>
<div class="line">$ sudo apt-get install -y clang-tools-6.0 libclang-6.0-dev cmake \</div>
<div class="line">    ocaml expect screen sshpass</div>
</div><!-- fragment --><p >For ubuntu 22.04 </p><div class="fragment"><div class="line"># Required tools to build the keystone</div>
<div class="line">$ sudo apt-get update</div>
<div class="line">$ sudo apt-get install -y autoconf automake autotools-dev bc bison \</div>
<div class="line">  build-essential curl expat libexpat1-dev flex gawk gcc git gperf libgmp-dev \</div>
<div class="line">  libmpc-dev libmpfr-dev libtool texinfo tmux patchutils zlib1g-dev wget \</div>
<div class="line">  bzip2 patch vim-common lbzip2 pkg-config libglib2.0-dev libpixman-1-dev \</div>
<div class="line">  libssl-dev screen device-tree-compiler expect makeself unzip cpio rsync cmake \</div>
<div class="line">  p7zip-full python3-pip e2tools</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md42"></a>
Download RISC-V toolchain and Keystone SDK</h2>
<p >Download the keystone sources</p>
<div class="fragment"><div class="line">$ git clone https://github.com/keystone-enclave/keystone.git -b v1.0.0</div>
<div class="line">$ cd keystone</div>
<div class="line">$ ./fast-setup.sh</div>
<div class="line">$ source ./source.sh</div>
</div><!-- fragment --><p >After executing the <code>./fast-setup.sh</code>, the toolchain for RISC-V has been installed at <code>keystone/riscv/bin</code> and it adds to your PATH.</p>
<p >Make the following changes to increase the max edge calls </p><div class="fragment"><div class="line">sed -i &#39;s/MAX_EDGE_CALL 10$/MAX_EDGE_CALL 1000/&#39; &lt;keystone_dir&gt;/sdk/include/edge/edge_common.h</div>
</div><!-- fragment --><p >Build the Keystone SDK</p>
<p >Make sure you are in keystone directory.</p>
<div class="fragment"><div class="line">$ cd sdk/</div>
<div class="line">$ mkdir -p build</div>
<div class="line">$ cd build</div>
<div class="line">$ cmake .. $SDK_FLAGS</div>
<div class="line">$ make</div>
<div class="line">$ make install</div>
</div><!-- fragment --><p >Build the Qemu Image</p>
<p >Make sure you are in <code>keystone</code> directory.</p>
<div class="fragment"><div class="line">$ mkdir -p build</div>
<div class="line">$ cd build</div>
<div class="line">$ cmake ..</div>
<div class="line">$ make</div>
<div class="line">$ make image</div>
</div><!-- fragment --><p >Launch the QEMU image</p>
<p >Make sure you are in <code>keystone\build</code> directory.</p>
<div class="fragment"><div class="line">$ ./scripts/run-qemu.sh</div>
<div class="line">Welcome to Buildroot</div>
</div><!-- fragment --><p >Login to console with the following credentials</p>
<p >buildroot login = root, Password = sifive</p>
<div class="fragment"><div class="line">buildroot login: root</div>
<div class="line">Password:</div>
<div class="line">$</div>
</div><!-- fragment --><p >Poweroff the console incase, if you want to exit.</p>
<div class="fragment"><div class="line">$ poweroff</div>
</div><!-- fragment --><p >You can also use <code>CTRL^A + X</code> to exit Qemu Console.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
Run Keystone examples</h2>
<p >Run the following commands to generate hello world example programs to be executed on qemu.</p>
<p >Make sure you are in <code>keystone\build</code> directory.</p>
<div class="fragment"><div class="line">$ make hello-package</div>
<div class="line">$ cp -r examples/hello ./overlay/root/</div>
<div class="line"># Update the image</div>
<div class="line">$ make image</div>
</div><!-- fragment --><p >Launch QEMU console <br  />
 </p><div class="fragment"><div class="line">$ ./scripts/run-qemu.sh</div>
<div class="line">Welcome to Buildroot</div>
</div><!-- fragment --><p >Login to console with user=root, passwd=sifive </p><div class="fragment"><div class="line">buildroot login: root</div>
<div class="line">Password:</div>
<div class="line">$</div>
</div><!-- fragment --><p >Run hello example </p><div class="fragment"><div class="line">$ insmod keystone-driver.ko</div>
<div class="line">[  365.354299] keystone_driver: loading out-of-tree module taints kernel.</div>
<div class="line">[  365.364279] keystone_enclave: keystone enclave v0.2</div>
<div class="line">$ ./hello/hello.ke</div>
<div class="line">Verifying archive integrity...  100%   All good.</div>
<div class="line">Uncompressing Keystone vault archive  100%</div>
<div class="line">hello, world!</div>
</div><!-- fragment --><p> You can also run the tests by executing <code>./tests.ke</code></p>
<p >Poweroff the console incase, if you want to exit. </p><div class="fragment"><div class="line">$ poweroff</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md44"></a>
OP-TEE (ARM64 Raspberry Pi 3 Model B)</h1>
<p >OP-TEE is a Trusted Execution Environment (TEE) designed as companion to a non-secure Linux kernel running on Arm. Lets build OP-TEE for QEMU and Raspberry Pi3 Model B development board. For more details check,</p><ul>
<li><a href="https://optee.readthedocs.io/en/latest/">https://optee.readthedocs.io/en/latest/</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md45"></a>
Required Packages</h2>
<p >Install the following packages</p>
<p >For ubuntu 20.04 </p><div class="fragment"><div class="line">$ sudo dpkg --add-architecture i386</div>
<div class="line"> </div>
<div class="line">$ sudo apt-get update</div>
<div class="line"> </div>
<div class="line">$ sudo apt-get install -y android-tools-adb android-tools-fastboot autoconf \</div>
<div class="line">  automake bc bison build-essential ccache cscope curl device-tree-compiler \</div>
<div class="line">  expect flex ftp-upload gdisk iasl libattr1-dev libc6:i386 libcap-dev \</div>
<div class="line">  libfdt-dev libftdi-dev libglib2.0-dev libhidapi-dev libncurses5-dev \</div>
<div class="line">  libpixman-1-dev libssl-dev libstdc++6:i386 libtool libz1:i386 make \</div>
<div class="line">  mtools netcat python python-crypto python3-crypto python-pyelftools \</div>
<div class="line">  python3-pycryptodome python3-pyelftools python3-serial vim-common \</div>
<div class="line">  rsync unzip uuid-dev xdg-utils xterm xz-utils zlib1g-dev \</div>
<div class="line">  git python3-pip wget cpio texlive texinfo locales</div>
</div><!-- fragment --><p >For ubuntu 22.04 </p><div class="fragment"><div class="line">$ sudo dpkg --add-architecture i386</div>
<div class="line">$ sudo apt-get update</div>
<div class="line">$ sudo apt-get install -y \</div>
<div class="line">  android-tools-adb android-tools-fastboot autoconf \</div>
<div class="line">  automake bc bison build-essential ccache cscope curl device-tree-compiler \</div>
<div class="line">  expect flex ftp-upload gdisk iasl libattr1-dev libc6:i386 libcap-dev \</div>
<div class="line">  libfdt-dev libftdi-dev libglib2.0-dev libhidapi-dev libncurses5-dev \</div>
<div class="line">  libpixman-1-dev libssl-dev libstdc++6:i386 libtool libz1:i386 make \</div>
<div class="line">  mtools netcat python2 \</div>
<div class="line">  python3-pycryptodome python3-pyelftools python3-serial vim-common \</div>
<div class="line">  rsync unzip uuid-dev xdg-utils xterm xz-utils zlib1g-dev \</div>
<div class="line">  git python3-pip wget cpio texlive texinfo cmake \</div>
<div class="line">  locales</div>
</div><!-- fragment --><p >Set the locale to English, to cope with the problem, <a href="https://github.com/OP-TEE/build/issues/424#issuecomment-631302208">https://github.com/OP-TEE/build/issues/424#issuecomment-631302208</a>.</p>
<div class="fragment"><div class="line">$ sudo locale-gen en_US.UTF-8</div>
<div class="line">$ export LANG=en_US.UTF-8</div>
<div class="line">$ export LANGUAGE=en_US:en</div>
<div class="line">$ export LC_ALL=en_US.UTF-8</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md46"></a>
Download and build OP-TEE Toolchains 3.10.0</h2>
<p >Create the directory to build the OP-TEE toolchains and export the toolchain directory</p>
<div class="fragment"><div class="line">$ sudo mkdir -p /opt/arm-tc</div>
<div class="line">$ export TOOLCHAIN_DIR=/opt/arm-tc</div>
</div><!-- fragment --><p >Clone and build the OP-TEE toolchain</p>
<div class="fragment"><div class="line">$ git clone https://github.com/OP-TEE/build.git -b 3.10.0</div>
<div class="line">$ cd build</div>
<div class="line">$ sudo make TOOLCHAIN_ROOT=${TOOLCHAIN_DIR} -f toolchain.mk -j2</div>
<div class="line">$ export PATH=${TOOLCHAIN_DIR}/aarch64/bin:${TOOLCHAIN_DIR}/aarch32/bin:${PATH}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md47"></a>
Download OP-TEE 3.10.0</h2>
<p >Install Android repo to sync the OP-TEE repo</p>
<div class="fragment"><div class="line">$ sudo git config --global user.name &quot;dummy&quot; &amp;&amp; \</div>
<div class="line">  sudo git config --global user.email &quot;dummy@gmail.com&quot; &amp;&amp; \</div>
<div class="line">  sudo git config --global color.ui false &amp;&amp; \</div>
<div class="line">  mkdir ~/bin &amp;&amp; \</div>
<div class="line">  curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo &amp;&amp; \</div>
<div class="line">  chmod a+x ~/bin/repo</div>
<div class="line"> </div>
<div class="line">$ export PATH=$~/bin:${PATH}</div>
</div><!-- fragment --><p >Get the source code for optee</p>
<div class="fragment"><div class="line">$ mkdir optee &amp;&amp; cd optee</div>
<div class="line">$ export OPTEE_DIR=$(pwd)</div>
<div class="line">$ repo init -u https://github.com/OP-TEE/manifest.git -m qemu_v8.xml -b 3.10.0</div>
<div class="line">$ repo sync -j4 --no-clone-bundle</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md48"></a>
Build OP-TEE 3.10.0</h2>
<div class="fragment"><div class="line">$ cd ${OPTEE_DIR}/build</div>
<div class="line">$ ln -s ${TOOLCHAIN_DIR} ${OPTEE_DIR}/toolchains</div>
<div class="line">$ make TOOLCHAIN_ROOT=${TOOLCHAIN_DIR} -j`nproc`</div>
</div><!-- fragment --><p >If build is successfull, the rootfs can be found as follows </p><div class="fragment"><div class="line">$ ls -l ${OPTEE_DIR}/out-br/images/rootfs.cpio.gz</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md49"></a>
Run OP-TEE Examples</h2>
<h3><a class="anchor" id="autotoc_md50"></a>
Launching QEMU Console</h3>
<p ><br  />
 Run following commands from OP-TEE build directory <br  />
</p>
<div class="fragment"><div class="line">$ cd $OPTEE_DIR/build</div>
<div class="line">$ make run</div>
</div><!-- fragment --><p> Once above command is success, QEMU is ready </p><div class="fragment"><div class="line">* QEMU is now waiting to start the execution</div>
<div class="line">* Start execution with either a &#39;c&#39; followed by &lt;enter&gt; in the QEMU console or</div>
<div class="line">* attach a debugger and continue from there.</div>
<div class="line">*</div>
<div class="line">* To run OP-TEE tests, use the xtest command in the &#39;Normal World&#39; terminal</div>
<div class="line">* Enter &#39;xtest -h&#39; for help.</div>
<div class="line"> </div>
<div class="line">cd /TEE/demo/rpi3/optee_3.9.0_qemu/build/../out/bin</div>
<div class="line">     &amp;&amp; /TEE/demo/rpi3/optee_3.9.0_qemu/build/../qemu/aarch64-softmmu/qemu-system-aarch64 \</div>
<div class="line">    -nographic \</div>
<div class="line">    -serial tcp:localhost:54320 -serial tcp:localhost:54321 \</div>
<div class="line">    -smp 2 \</div>
<div class="line">    -s -S -machine virt,secure=on -cpu cortex-a57 \</div>
<div class="line">    -d unimp -semihosting-config enable,target=native \</div>
<div class="line">    -m 1057 \</div>
<div class="line">    -bios bl1.bin \</div>
<div class="line">    -initrd rootfs.cpio.gz \</div>
<div class="line">    -kernel Image -no-acpi \</div>
<div class="line">    -append &#39;console=ttyAMA0,38400 keep_bootcon root=/dev/vda2&#39; \</div>
<div class="line">    -object rng-random,filename=/dev/urandom,id=rng0 -device virtio-rng-pci,rng=rng0,max-bytes=1024,</div>
<div class="line">        period=1000 -netdev user,id=vmnic -device virtio-net-device,netdev=vmnic</div>
<div class="line">QEMU 3.0.93 monitor - type &#39;help&#39; for more information</div>
<div class="line">(qemu) c</div>
<div class="line">Now Optee started to boot from another tab on the Terminal</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md51"></a>
Run hello world example</h3>
<p ><br  />
 Once boot completed it displays following message, then enter "root" to login to the shell <br  />
</p>
<div class="fragment"><div class="line">Welcome to Buildroot, type root or test to login</div>
<div class="line">buildroot login: root</div>
<div class="line">$</div>
<div class="line">$ optee_example_hello_world</div>
<div class="line">Invoking TA to increment 42</div>
<div class="line">TA incremented value to 43</div>
</div><!-- fragment --><p >Poweroff the console in case, if you want to exit.</p>
<div class="fragment"><div class="line">$ poweroff</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md52"></a>
SGX (Intel NUC)</h1>
<p >Intel(R) Software Guard Extensions (Intel(R) SGX) is an Intel technology for application developers who is seeking to protect selected code and data from disclosure or modification. For more details check,</p><ul>
<li><a href="https://github.com/intel/linux-sgx/blob/master/README.md">https://github.com/intel/linux-sgx/blob/master/README.md</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md53"></a>
System Requirements</h2>
<h3><a class="anchor" id="autotoc_md54"></a>
List of machines which are confirmed to work</h3>
<p >Following are the the Intel NUC device which has been tested to make sure the TA-Ref sdk worked fine.</p>
<ol type="1">
<li>Intel NUC7PJYH - Intel(R) Celeron(R) J4005 CPU @ 2.00GHz</li>
<li>Intel NUC7PJYH - Intel(R) Pentium(R) Silver J5005 CPU @ 1.50GHz</li>
<li>Intel NUC9VXQNX - Intel(R) Xeon(R) E-2286M CPU @ 2.40GHz (Partially working)</li>
</ol>
<h3><a class="anchor" id="autotoc_md55"></a>
BIOS Versions which are failed or scucceeded in IAS Test</h3>
<ol type="1">
<li>BIOS Version JYGLKCPX.86A.0050.2019.0418.1441 - IAS Test was Failed</li>
<li>BIOS Version JYGLKCPX.86A.0053.2019.1015.1510 - IAS Test was Failed</li>
<li>BIOS Version JYGLKCPX.86A.0057.2020.1020.1637 - IAS Test was Success</li>
<li>BIOS Version QNCFLX70.0034.2019.1125.1424 - IAS Test was Failed</li>
<li>BIOS Version QNCFLX70.0059.2020.1130.2122 - IAS Test was Success</li>
</ol>
<p >Update BIOS from:</p><ul>
<li><a href="https://downloadcenter.intel.com/download/29987/BIOS-Update-JYGLKCPX-">https://downloadcenter.intel.com/download/29987/BIOS-Update-JYGLKCPX-</a></li>
<li><a href="https://downloadcenter.intel.com/download/30069/BIOS-Update-QNCFLX70-">https://downloadcenter.intel.com/download/30069/BIOS-Update-QNCFLX70-</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md56"></a>
BIOS Settings</h3>
<ol type="1">
<li>Make sure you are running with latest version BIOS</li>
<li>Make sure you enabled SGX support in BIOS</li>
<li>Make sure <code>Secure Boot</code> disabled in BIOS</li>
</ol>
<p >Refer: <a href="https://github.com/intel/sgx-software-enable/blob/master/README.md">https://github.com/intel/sgx-software-enable/blob/master/README.md</a></p>
<h2><a class="anchor" id="autotoc_md57"></a>
Required Packages</h2>
<p >Install following packages.</p>
<p >For ubuntu 20.04 </p><div class="fragment"><div class="line">$ sudo apt-get update</div>
<div class="line">$ sudo apt-get install -y build-essential ocaml ocamlbuild automake autoconf \</div>
<div class="line">  libtool wget python libssl-dev git cmake perl libssl-dev \</div>
<div class="line">  libcurl4-openssl-dev protobuf-compiler libprotobuf-dev debhelper cmake \</div>
<div class="line">  reprepro expect unzip libcurl4 libprotobuf17 python3-pipcurl libcap-dev</div>
</div><!-- fragment --><p >For ubuntu 22.04 </p><div class="fragment"><div class="line">$ sudo apt-get update</div>
<div class="line">$ sudo apt-get install -y \</div>
<div class="line">  build-essential ocaml ocamlbuild automake autoconf \</div>
<div class="line">  libtool wget libssl-dev git cmake perl libssl-dev \</div>
<div class="line">  libcurl4-openssl-dev protobuf-compiler libprotobuf-dev debhelper cmake \</div>
<div class="line">  reprepro expect unzip libcurl4 libprotobuf23 python3-pip curl libcap-dev</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md58"></a>
Build SGX</h2>
<p >There are 3 components which need to be build for SGX</p><ol type="1">
<li>linux-sgx</li>
<li>linux-sgx-driver</li>
<li>sgx-ra-sample</li>
</ol>
<h3><a class="anchor" id="autotoc_md59"></a>
Build and install linux-sgx</h3>
<p >Setup the environment variables</p>
<div class="fragment"><div class="line">$ export OPT_INTEL=/opt/intel</div>
<div class="line">$ export SDK_INSTALL_DIR=${OPT_INTEL}/sgxsdk</div>
<div class="line">$ export PATH=${PATH}:${SDK_INSTALL_DIR}/bin:${SDK_INSTALL_DIR}/bin/x64</div>
<div class="line">$ export PKG_CONFIG_PATH=${SDK_INSTALL_DIR}/pkgconfig</div>
<div class="line">$ export LD_LIBRARY_PATH=${SDK_INSTALL_DIR}/sdk_libs</div>
</div><!-- fragment --><p ><b>Build and install Intel SGX SDK</b></p>
<div class="fragment"><div class="line">$ git clone https://github.com/intel/linux-sgx.git -b sgx_2.10</div>
<div class="line">$ cd linux-sgx</div>
<div class="line"> </div>
<div class="line"># Download the prebuilt binaries for intel sgx</div>
<div class="line">$ ./download_prebuilt.sh</div>
<div class="line">$ cd external/toolset/ubuntu20.04/ &amp;&amp; sudo cp as ld ld.gold objdump /usr/local/bin</div>
<div class="line"> </div>
<div class="line"># Make the intel sdk package</div>
<div class="line">$ make sdk_install_pkg DEBUG=1</div>
</div><!-- fragment --><p >Make a script to install the intel sgx in OPT_INTEL</p>
<div class="fragment"><div class="line">$ echo &#39;#!/usr/bin/expect -f \n\</div>
<div class="line">set install_bin [lindex $argv 0]; \n\</div>
<div class="line">set output_dir [lindex $argv 1]; \n\</div>
<div class="line">spawn $install_bin \n\</div>
<div class="line">expect &quot;Do you want to install in current directory?&quot; \n\</div>
<div class="line">send &quot;no\r&quot; \n\</div>
<div class="line">expect &quot;Please input the directory which you want to install in&quot; \n\</div>
<div class="line">send &quot;$output_dir\r&quot; \n\</div>
<div class="line">expect eof&#39; &gt; exp.sh</div>
</div><!-- fragment --><p >Set the executable permissions for the script and execute the script</p>
<div class="fragment"><div class="line">$ chmod u+x exp.sh</div>
<div class="line">$ sudo mkdir -p ${OPT_INTEL}</div>
<div class="line">$ sudo ./exp.sh &lt;linux-sgx dir&gt;/linux/installer/bin/sgx_linux_x64_sdk_2.10.100.2.bin ${OPT_INTEL}</div>
</div><!-- fragment --><p ><b>Build the Intel(R) SGX PSW and its installer</b></p>
<div class="fragment"><div class="line"># deb_psw_pkg includes `make psw`</div>
<div class="line"># see Note) in https://github.com/intel/linux-sgx/tree/sgx_2.8#build-the-intelr-sgx-psw-and-intelr-sgx-psw-installer</div>
<div class="line">$ export DEB_BUILD_OPTIONS=&quot;nostrip&quot;</div>
<div class="line">$ SGX_PSW_INSTALLER_DIR=${CLONE_DIR}/linux/installer</div>
<div class="line">$ make deb_psw_pkg DEBUG=${DEBUG}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"># install *.deb in PSW except sgx-dcap-pccs because this package requires npm and nodejs,</div>
<div class="line"># which cannot be installed via apt-get</div>
<div class="line">$ rm ${SGX_PSW_INSTALLER_DIR}/deb/*/sgx-dcap-pccs*.deb</div>
<div class="line">$ sudo dpkg -i ${SGX_PSW_INSTALLER_DIR}/deb/*/*.deb</div>
</div><!-- fragment --><p >Making it sure the installed SGX libaries will properly working.</p>
<div class="fragment"><div class="line">$ sudo ldconfig /opt/intel/sgxsdk/lib64</div>
</div><!-- fragment --><p >If you are going to run in a SIM mode (not running in actaul Intel SGX hardware), then you can skip the following steps and go to building TA-Ref for Intel SGX section.</p>
<h3><a class="anchor" id="autotoc_md60"></a>
Build and Install SGX Driver</h3>
<p ><br  />
 See <a href="https://github.com/intel/linux-sgx-driver">linux-sgx-driver</a>.</p>
<p >Caveat: Whenever updating kernel, don't forget rebuilding this driver with new version of the kernel header. (There are a few linux-sgx-driver-dkms repo, though I've experianced troubles with them.)</p>
<p >Clone and build <br  />
 </p><div class="fragment"><div class="line">$ git clone https://github.com/intel/linux-sgx-driver.git</div>
<div class="line">$ cd linux-sgx-driver</div>
<div class="line">$ make</div>
</div><!-- fragment --><p >Install SGX driver <br  />
 </p><div class="fragment"><div class="line">$ sudo mkdir -p &quot;/lib/modules/&quot;`uname -r`&quot;/kernel/drivers/intel/sgx&quot;</div>
<div class="line">$ sudo cp isgx.ko &quot;/lib/modules/&quot;`uname -r`&quot;/kernel/drivers/intel/sgx&quot;</div>
<div class="line">$ sudo sh -c &quot;cat /etc/modules | grep -Fxq isgx || echo isgx &gt;&gt; /etc/modules&quot;</div>
<div class="line">$ sudo /sbin/depmod</div>
<div class="line">$ sudo /sbin/modprobe isgx</div>
</div><!-- fragment --><p >When modprove fails with "Operation is not permitted", disable <code>secure boot</code> in BIOS. So that the unsigned kernel driver can be installed. If it is success, reboot your machine and verify <code>sudo lsmod | grep isgx</code> if it shows <code>isgx.ko</code></p>
<h2><a class="anchor" id="autotoc_md61"></a>
Run sgx-ra-sample</h2>
<h3><a class="anchor" id="autotoc_md62"></a>
Build sgx-ra-sample</h3>
<p >Clone and build OpenSSL 1.1.c</p>
<div class="fragment"><div class="line">$ wget https://www.openssl.org/source/openssl-1.1.1c.tar.gz</div>
<div class="line">$ tar xf openssl-1.1.1c.tar.gz</div>
<div class="line">$ cd openssl-1.1.1c/</div>
<div class="line">$ ./config --prefix=/opt/openssl/1.1.1c --openssldir=/opt/openssl/1.1.1c</div>
<div class="line">$ make</div>
<div class="line">$ sudo make install</div>
<div class="line">$ cd ..</div>
</div><!-- fragment --><p >Clone and build sgx-ra-sample <br  />
</p>
<div class="fragment"><div class="line">$ git clone https://github.com/intel/sgx-ra-sample.git</div>
<div class="line">$ cd sgx-ra-sample/</div>
<div class="line">$ ./bootstrap</div>
<div class="line">$ ./configure --with-openssldir=/opt/openssl/1.1.1c</div>
<div class="line">$ make</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md63"></a>
Prepare for IAS Test</h3>
<ol type="1">
<li>Obtain a subscription key for the Intel SGX Attestation Service Utilizing Enhanced Privacy ID (EPID). See here: <a href="https://api.portal.trustedservices.intel.com/EPID-attestation">https://api.portal.trustedservices.intel.com/EPID-attestation</a></li>
<li>Download Intel_SGX_Attestation_RootCA.pem form above portal.</li>
<li>Edit <code>settings</code> file and update the file with your own values obtained from portal. <br  />
</li>
</ol>
<div class="fragment"><div class="line">@@ -15,14 +15,14 @@ QUERY_IAS_PRODUCTION=0</div>
<div class="line"> # Your Service Provider ID. This should be a 32-character hex string.</div>
<div class="line"> # [REQUIRED]</div>
<div class="line"> </div>
<div class="line">-SPID=0123456789ABCDEF0123456789ABCDEF</div>
<div class="line">+SPID=EF9AE4A8635825B88751C8698CB370B4</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> # Set to a non-zero value if this SPID is associated with linkable</div>
<div class="line"> # quotes. If you change this, you&#39;ll need to change SPID,</div>
<div class="line"> # IAS_PRIMARY_SUBSCRIPTION_KEY and IAS_SECONDARY_SUBSCRIPTION_KEY too.</div>
<div class="line"> </div>
<div class="line">-LINKABLE=0</div>
<div class="line">+LINKABLE=1</div>
<div class="line"> </div>
<div class="line"> #======================================================================</div>
<div class="line">@@ -50,18 +50,18 @@ USE_PLATFORM_SERVICES=0</div>
<div class="line"> # More Info: https://api.portal.trustedservices.intel.com/EPID-attestation</div>
<div class="line"> # Associated SPID above is required</div>
<div class="line"> </div>
<div class="line">-IAS_PRIMARY_SUBSCRIPTION_KEY=</div>
<div class="line">+IAS_PRIMARY_SUBSCRIPTION_KEY=b6da4c9c41464924a14954ad8c03e8cf</div>
<div class="line"> </div>
<div class="line"> # Intel Attestation Service  Secondary Subscription Key</div>
<div class="line"> # This will be used in case the primary subscription key does not work</div>
<div class="line"> </div>
<div class="line">-IAS_SECONDARY_SUBSCRIPTION_KEY=</div>
<div class="line">+IAS_SECONDARY_SUBSCRIPTION_KEY=188d91f86c064deb97e7472175ae1e79</div>
<div class="line"> </div>
<div class="line"> # The Intel IAS SGX Report Signing CA file. You are sent this certificate</div>
<div class="line"> # when you apply for access to SGX Developer Services at</div>
<div class="line"> # http://software.intel.com/sgx [REQUIRED]</div>
<div class="line"> </div>
<div class="line">-IAS_REPORT_SIGNING_CA_FILE=</div>
<div class="line">+IAS_REPORT_SIGNING_CA_FILE=./Intel_SGX_Attestation_RootCA.pem</div>
<div class="line"> </div>
<div class="line"> # Debugging options</div>
<div class="line">@@ -82,7 +82,7 @@ IAS_REPORT_SIGNING_CA_FILE=</div>
<div class="line"> </div>
<div class="line"> # Set to non-zero for verbose output</div>
<div class="line"> </div>
<div class="line">-VERBOSE=0</div>
<div class="line">+VERBOSE=1</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md64"></a>
Run IAS Test</h3>
<p ><br  />
 Run "run-server" <br  />
</p>
<div class="fragment"><div class="line">$ ./run-server</div>
<div class="line">Listening for connections on port 7777</div>
<div class="line">Waiting for a client to connect...</div>
<div class="line">Connection from 127.0.0.1</div>
<div class="line">Waiting for msg0||msg1</div>
<div class="line"> </div>
<div class="line">---- Copy/Paste Msg2 Below to Client ---------------------------------------</div>
<div class="line">44f2e22125f052e0118018febceefd469f1f4b73de22b34ebdf27003605963946bb862980be691a2f532d8e66abb2ce4eaad</div>
<div class="line">f778593b1ce7a14b2759f133beceef9ae4a8635825b88751c8698cb370b401000100fbb75d7ce414edc45510aa87a7547ffb</div>
<div class="line">a65415fca10e83c0936729c2abfb6c2687ee6dde5c6540a835fae6032bbfaf9f8eaefbcfafcf606e94ece103d82ecc82a457</div>
<div class="line">a16692d4023dad4e4fee38fb20d00000000</div>
<div class="line">----------------------------------------------------------------------------</div>
<div class="line">Waiting for msg3</div>
<div class="line">+++ POST data written to /tmp/wgetpostwnMRxU</div>
<div class="line"> </div>
<div class="line">---- Copy/Paste Msg4 Below to Client ---------------------------------------</div>
<div class="line">0300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</div>
<div class="line">0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</div>
<div class="line">0000000000</div>
<div class="line">----------------------------------------------------------------------------</div>
<div class="line">Waiting for a client to connect...</div>
</div><!-- fragment --><p >Open another terminal and run "run-client" <br  />
</p>
<div class="fragment"><div class="line">$ ./run-client</div>
<div class="line"> </div>
<div class="line">---- Copy/Paste Msg0||Msg1 Below to SP -------------------------------------</div>
<div class="line">00000000a7fa6ed63bec97891885abc2e2e80bd4bb2bd5bb32a7e142337f486bb9f6e76a9db59aa9</div>
<div class="line">aaac50cd24c3625451a79bce7c51e24447981444cf51666f3b61cd0cfb0b0000</div>
<div class="line">----------------------------------------------------------------------------</div>
<div class="line">Waiting for msg2</div>
<div class="line"> </div>
<div class="line">---- Copy/Paste Msg3 Below to SP -------------------------------------------</div>
<div class="line">787d992031b5ed7d57f149aec7f04912a7fa6ed63bec97891885abc2e2e80bd4bb2bd5bb32a7e142337f486bb9f6e76a9db5</div>
<div class="line">9aa9aaac50cd24c3625451a79bce7c51e24447981444cf51666f3b61cd0c0000000000000000000000000000000000000000</div>
<div class="line">0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</div>
<div class="line">0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</div>
<div class="line">0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</div>
<div class="line">0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</div>
<div class="line">00000000000000000000000000000000000000000000000000000000000000000000000002000100fb0b00000b000a000000</div>
<div class="line">0000ef9ae4a8635825b88751c8698cb370b40000000000000000000000000000000003030000000000000000000000000000</div>
<div class="line">000000000000000000000000000000000000000000000000000000000000000007000000000000000300000000000000188d</div>
<div class="line">d04a51cc90bf27ca2e733a3a97557dcaabff3e2d037d11a1d0680c8f22c10000000000000000000000000000000000000000</div>
<div class="line">00000000000000000000000bd71c6380ef77c5417e8b2d1ce2d4b6504b9f418e5049342440cfff2443d95bd0000000000000</div>
<div class="line">0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</div>
<div class="line">0000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000</div>
<div class="line">0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</div>
<div class="line">0000000ab2e17de92aadea169f418e9266ea4e79b393f0028754ed46c6e538d3aed1e5a00000000000000000000000000000</div>
<div class="line">00000000000000000000000000000000000a80200007657efd8ff80410670f40aba48cc5a0c61aa70a3c656f021c28104503</div>
<div class="line">9ea3c16f5831825fd3405eb6090d70a6e87853374eefb690285367ac35f471df09571fda8f96de9e2067f6f7c12fa97a4f06</div>
<div class="line">5311e71d01cd97a89c93c9ba9b0d02d56723f67a51ee742974c46d05e313db18826f6b4183a83a421b0df4b6c3a059b814a3</div>
<div class="line">7d6b905f28422076e41d23016b22d1ec2ea5712c6bc470070313d8d50f6968b97e1ca65524ec677191b5ccb5c14e9629efc1</div>
<div class="line">e1e1cc6e87388143712c1f15593ec5fdea02ce426139c461cfd6cc63025124ed5ea5c0160fdb59ea65e97449d44d78355018</div>
<div class="line">c54f11290930d8464096723fc0e25421fb0849a156ce0af973af0324a86bdb583501f0779e86d108afef02faa6c73c6d6035</div>
<div class="line">e8d4c8ba3478ca58779dd26f015d31dff046e8d74fe680100004af4eed5e48babde1db56dc88ab96a689de24c33ad955ca33</div>
<div class="line">86d9bf9fb842d2ef2f09883e9dead7e5c58c841181e987599532e769b3e1445a570c7b7fc5d866906d5064770919001a47b3</div>
<div class="line">f4dde0635451047a0d1fc8a3971525866fa07da59e3cce44e71eba19a8a00e265ecc04dc5529a942afe6dd222045e746411c</div>
<div class="line">d4c89541a432de0c7464ba8d54e775f1530098a3fc4876c140028e12edcd0e3df1b176271f74207b54b0bd76a9d4b3549f8b</div>
<div class="line">b950a492a64a4949eeaa8192432d99eabebd46eb56507a675c184de8ee6c53461753cf123bb9e26ddfb8422e4c130efe7c5d</div>
<div class="line">f3f328cb02945bfa575f79e376d9aac40da397e9cdcb449f223842bec9e07e4b2c736409ed964799ac9cf51a71f0cbdf91f9</div>
<div class="line">4bd362e761ae35ed27d2872112caf2476846e397141106d9898b96295fa969dbd9b48c7dd8f27c5ba1bb1d6bb202aad86346</div>
<div class="line">695c8f18efe073e9424382f3f73757ee99e95c30da5dd47d94185eda2b97613b0872a622c58f4f2dd91d1e4d876ac8e40a18</div>
<div class="line">60a</div>
<div class="line">----------------------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line">---- Enclave Trust Status from Service Provider ----------------------------</div>
<div class="line">Enclave TRUSTED</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md65"></a>
Possible wget Error</h3>
<p ><br  />
 Server may invoke wget command to get some files from intel servers. If the server side fails with following error <br  />
</p>
<div class="fragment"><div class="line">Connecting to api.trustedservices.intel.com (api.trustedservices.intel.com)|40.87.90.88|:443... connected.</div>
<div class="line">ERROR: cannot verify api.trustedservices.intel.com&#39;s certificate, issued by &#39;CN=COMODO RSA Organization Validation Secure Server CA,O=COMODO CA Limited,L=Salford,ST=Greater Manchester,C=GB&#39;:</div>
<div class="line">  Unable to locally verify the issuer&#39;s authority.</div>
<div class="line">To connect to api.trustedservices.intel.com insecurely, use `--no-check-certificate&#39;.</div>
</div><!-- fragment --><p >then add a line <code>ca-certificate = /etc/ssl/certs/ca-certificates.crt</code> to /etc/wgetrc file as super user, then test again.</p>
<h3><a class="anchor" id="autotoc_md66"></a>
BIOS Updating</h3>
<p ><br  />
 If BIOS version is outdated, IAS may not succeed. So when you are done with BIOS update, the sgx driver would be reqired to make and install again.</p>
<p >Update BIOS from:</p><ul>
<li><a href="https://downloadcenter.intel.com/download/29987/BIOS-Update-JYGLKCPX-">https://downloadcenter.intel.com/download/29987/BIOS-Update-JYGLKCPX-</a></li>
<li><a href="https://downloadcenter.intel.com/download/30069/BIOS-Update-QNCFLX70-">https://downloadcenter.intel.com/download/30069/BIOS-Update-QNCFLX70-</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md67"></a>
Run LocalAttestation</h3>
<p ><br  />
 Running SDK code samples in simulation mode <br  />
 </p><div class="fragment"><div class="line">$ source /opt/intel/sgxsdk/environment</div>
<div class="line">$ cd linux-sgx/SampleCode/LocalAttestation</div>
<div class="line">$ make SGX_MODE=SIM</div>
<div class="line">$ cd bin</div>
<div class="line">$ ./app</div>
<div class="line">succeed to load enclaves.</div>
<div class="line">succeed to establish secure channel.</div>
<div class="line">Succeed to exchange secure message...</div>
<div class="line">Succeed to close Session...</div>
</div><!-- fragment --><p >Running in hardware mode (It works when you have latest BIOS and SGX support is enabled in BIOS) <br  />
 </p><div class="fragment"><div class="line">$ source /opt/intel/sgxsdk/environment</div>
<div class="line">$ cd linux-sgx/SampleCode/LocalAttestation</div>
<div class="line">$ make SGX_MODE=HW</div>
<div class="line">$ cd bin</div>
<div class="line">$ ./app</div>
<div class="line">succeed to load enclaves.</div>
<div class="line">succeed to establish secure channel.</div>
<div class="line">Succeed to exchange secure message...</div>
<div class="line">Succeed to close Session...</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md68"></a>
Doxygen</h1>
<p >This PDF (ta-ref.pdf) was generated using Doxygen version 1.9.2. To install <code>doxygen-1.9.2</code> following procedure is necessary.</p>
<h2><a class="anchor" id="autotoc_md69"></a>
Required Packages</h2>
<p >Install following packages on Ubuntu. Its better to install from package rather than using apt-install.</p>
<div class="fragment"><div class="line">$ sudo apt-get update</div>
<div class="line">$ sudo apt-get install -y build-essential doxygen-latex graphviz texlive-full texlive-latex-base latex-cjk-all make cmake flex bison git</div>
</div><!-- fragment --><p >Above packages required to generate PDF using doxygen.</p>
<h2><a class="anchor" id="autotoc_md70"></a>
Build and Install Doxygen</h2>
<div class="fragment"><div class="line">$ git clone https://github.com/doxygen/doxygen.git</div>
<div class="line">$ cd doxygen</div>
<div class="line">$ git checkout 227952da7562a6f13da2a9d19c3cdc93812bc2de</div>
<div class="line">$ mkdir build</div>
<div class="line">$ cd build</div>
<div class="line">$ cmake -G &quot;Unix Makefiles&quot; ..</div>
<div class="line">$ make</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md71"></a>
Customizing MbedTLS Configuration file</h1>
<p >MbedTLS is a C library that implements cryptographic primitives, X.509 certificate manipulation and the SSL/TLS and DTLS protocols. MbedTLS has a configuration file <code>config.h</code> where we can select platform-specific settings, customize the features that will be build, select the modules and its configurations.</p>
<p >In our case, we customize mbedtls config file to add/remove crypto algorithms when building the mbedtls. The mbedtls default config supports many cryto algorithms which might be unneccessary and also increases the built binary size.</p>
<p >It is advisable to reduce the size of the binaries, by selecting only the required crypto algorithms for the embedded systems.</p>
<h2><a class="anchor" id="autotoc_md72"></a>
What can be customized?</h2>
<ol type="1">
<li>how many hash algorithms to be supported<br  />
 For ex: md5, sha1, sha256, sha3 or etc</li>
<li>how many symmetric algorithms to be supported<br  />
 For ex: des, aes-cbc, aes-gcm or etc</li>
<li>how many asymmetric algorithms to be supported<br  />
 For ex: dsa, rsa, ecdsa, eddsa or etc and their key length</li>
</ol>
<h2><a class="anchor" id="autotoc_md73"></a>
mbedtls configuration file (config.h)</h2>
<p >The mbedtls official way is customizing config file is by editing the <code>include/mbedtls/config.h</code> file. But in optee’s build system, it require modifying<br  />
 <code>optee_os/lib/libmbedtls/include/mbedtls_config_kernel.h</code></p>
<p >Below are the different environments mbedtls config file locations, reference file and sample config.h configurations.</p>
<h3><a class="anchor" id="autotoc_md74"></a>
Optee mbetls config file</h3>
<p ><br  />
</p>
<p >Location of the config file in optee environment<br  />
 <code>optee/mbedtls/include/mbedtls/config.h</code> <br  />
</p>
<p >Have a look at the source which uses config.h file for reference.<br  />
 Example source:<br  />
 <code>optee/mbedtls/include/mbedtls/library/ssl_ciphersuites.c</code> <br  />
</p>
<p >Some sample configurations can be found in <code>configs/</code> directory. In Optee, the contents of configs directory is listed below. </p><div class="fragment"><div class="line">$ ls -l optee/mbedtls/configs</div>
<div class="line">total 24</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2852 Feb 17  2021 config-ccm-psk-tls1_2.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2102 Feb 17  2021 config-mini-tls1_1.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2628 Feb 17  2021 config-no-entropy.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 3573 Feb 17  2021 config-suite-b.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2680 Feb 17  2021 config-thread.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 1050 Feb 17  2021 README.txt</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md75"></a>
TA-Ref mbetls config file</h3>
<p ><br  />
</p>
<p >Location of the config file in TA-Ref environment<br  />
 <code>ta-ref/teep-device/libteep/mbedtls/include/mbedtls/config.h</code> <br  />
</p>
<p >Have a look at the source which uses config.h file for reference.<br  />
 Example source:<br  />
 <code>ta-ref/teep-device/libteep/mbedtls/include/mbedtls/library/ssl_ciphersuites.c</code> <br  />
</p>
<p >Some sample configurations can be found in <code>configs/</code> directory. In TA-Ref, the contents of configs directory is listed below. </p><div class="fragment"><div class="line">$ ls -l ta-ref/teep-device/libteep/mbedtls/configs</div>
<div class="line">total 24</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2852 Feb 18  2021 config-ccm-psk-tls1_2.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2102 Feb 18  2021 config-mini-tls1_1.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2628 Feb 18  2021 config-no-entropy.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 3573 Feb 18  2021 config-suite-b.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2680 Feb 18  2021 config-thread.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 1050 Feb 18  2021 README.txt</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md76"></a>
TEEP-Device mbetls config file</h3>
<p ><br  />
</p>
<p >Location of the config file in teep-device environment<br  />
 <code>teep-device/libteep/mbedtls/include/mbedtls/config.h</code> <br  />
</p>
<p >Have a look at the source which uses config.h file for reference.<br  />
 Example source:<br  />
 <code>teep-device/libteep/mbedtls/include/mbedtls/library/ssl_ciphersuites.c</code> <br  />
</p>
<p >Some sample configurations can be found in <code>configs/</code> directory. In teep-device, the contents of configs directory is listed below. </p><div class="fragment"><div class="line">$ ls -l teep-device/libteep/mbedtls/configs</div>
<div class="line">total 24</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2852 Feb 18  2021 config-ccm-psk-tls1_2.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2102 Feb 18  2021 config-mini-tls1_1.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2628 Feb 18  2021 config-no-entropy.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 3573 Feb 18  2021 config-suite-b.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 2680 Feb 18  2021 config-thread.h</div>
<div class="line">-rw-r--r-- 1 akirat akirat 1050 Feb 18  2021 README.txt</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md77"></a>
Supplement Investigation information</h2>
<p >It is necessary to edit the following file to select the cryptographic algorithm when using mbedtls in optee.<br  />
</p>
<p >In optee, AES-GCM is not included by default. So we need to modify the mbedtls config file to enable AES-GCM algorithm. Below is the path of the file in optee kernal where we will select the crypto algorithms. <br  />
 <code>optee/optee_os/lib/libmbedtls/include/mbedtls_config_kernel.h</code></p>
<p >Below is the path of file in TA SDK where we will select the crypto algorithms. In TA sdk, the AES-GCM is enabled by default. So any TA which uses AES-GCM should build successfully without any modification to the mbedtls config file.<br  />
 <code>optee/optee_os/lib/libmbedtls/include/mbedtls_config_uta.h</code> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
